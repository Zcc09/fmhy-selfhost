name: Hourly Auto-Merge to Hosting
on:
  schedule:
    - cron: '5 * * * *' # Runs at 5 minutes past every hour
  workflow_dispatch: # Allows manual trigger

jobs:
  merge-and-protect:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Hosting Branch
        uses: actions/checkout@v4
        with:
          ref: hosting # Your deployment branch
          fetch-depth: 0

      - name: Configure Git
        run: |
          git config user.name "GitHub Action"
          git config user.email "action@github.com"

      - name: Merge Main into Hosting
        run: |
          # 1. Start the merge but don't commit it yet
          git merge origin/main --no-commit --no-ff || true
          
          # 2. Force-restore your custom files from the 'hosting' branch
          git checkout HEAD -- docker-compose.yaml
          
          # 3. Finalize the merge
          git commit -m "Hourly sync from main (preserved custom config)" || echo "No changes to sync"
          git push origin hosting
